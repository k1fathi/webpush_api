{
  "id": "3",
  "title": "Merhaba {name}, sepetinizdeki ürün tükeniyor!",
  "body": "{product} için son {time} saat kaldı. Hemen tamamla: {link}",
  "icon": "https://cdn.example.com/notification-icon.png",
  "image": "https://cdn.example.com/product-image.jpg",
  "badge": "/badge-icon.png",
  "data": {
    "deep_link": "/cart",
    "campaign_id": "cart-abandoned-2023",
    "variables": {
      "name": "Ahmet",
      "product": "iPhone 15",
      "time": "24",
      "link": "https://example.com/cart"
    }
  },
  "segments": ["vip_users", "cart_abandoners"], // CDP/CEP entegrasyonlu segmentler
  "targeting_rules": {
    "country": "TR",
    "last_activity": ">7d",
    "purchase_history": ">=2"
  },
  "actions": [
    {
      "type": "button",
      "title": "Sepete Git",
      "action": "open_deep_link"
    }
  ],
  "schedule": {
    "type": "trigger_based", // "time_based" veya "trigger_based"
    "trigger_type": "cart_abandoned", // Sepet terk, doğum günü vb.
    "trigger_conditions": {
      "abandon_time": "24h",
      "product_category": "electronics"
    },
    "send_at": "2023-10-10T14:30:00.000Z" // Zamanlanmış gönderim için
  },
  "tracking": {
    "enable_delivery_tracking": true,
    "enable_open_tracking": true,
    "enable_click_tracking": true,
    "utm_params": {
      "source": "webpush",
      "campaign": "cart_abandoned"
    }
  },
  "ab_test_group": "A", // A/B test gruplama
  "variant_id": "variation-1", // Şablon varyantı
  "priority": "high", // Aciliyet seviyesi
  "ttl": 86400, // 24 saat (saniye cinsinden)
  "require_interaction": true, // Kullanıcı etkileşimi zorunlu mu?
  "webhooks": {
    "delivery": "https://webhook.example.com/delivery",
    "click": "https://webhook.example.com/click",
    "conversion": "https://webhook.example.com/conversion"
  },
  "cep_strategy": {
    "channel_priority": ["webpush", "email"], // CEP ile kanal önceliği
    "optimal_time": "user_preference" // Kullanıcı etkileşim zamanı
  },
  "cdp_data": {
    "user_id": "user-123",
    "profile": {
      "loyalty_tier": "vip",
      "last_purchase": "2023-10-01"
    }
  },
  "created_at": "2023-10-05T14:30:00.000Z"
}



 INFO:core.database:Existing tables: ['templates', 
 'campaigns', 
 'notifications', 
 'notification_schedules', 
 'notification_actions', 
 'notification_tracking', 
 'notification_segments', 
 'delivery_statuses', 
 'subscriptions', 
 'webhook_events']




pg_dump -U webpush_user -d webpush_db -F p -f "C:\\K1\\ZUZZUU\\webpush\\webpush_api\\sql\\webpush_db_backup.sql"






erDiagram

NOTIFICATION {
  id string
  title string
  body string
  icon string
  image string
  badge string
  data NotificationData
  segments string[]
  targeting_rules TargetingRules
  actions NotificationAction[]
  schedule NotificationSchedule
  tracking TrackingSettings
  ab_test_group string
  variant_id string
  priority string
  ttl number
  require_interaction boolean
  webhooks Webhooks
  cep_strategy CEPStrategy
  cdp_data CDPData
  created_at string
}

NOTIFICATIONDATA {
  deep_link string
  campaign_id string
  variables Variables
}

VARIABLES {
  name string
  product string
  time string
  link string
}

TARGETINGRULES {
  country string
  last_activity string
  purchase_history string
}

NOTIFICATIONACTION {
  type string
  title string
  action string
}

NOTIFICATIONSCHEDULE {
  type string
  trigger_type string
  trigger_conditions TriggerConditions
  send_at string
}

TRIGGERCONDITIONS {
  abandon_time string
  product_category string
}

TRACKINGSETTINGS {
  enable_delivery_tracking boolean
  enable_open_tracking boolean
  enable_click_tracking boolean
  utm_params UTMParams
}

UTMPARAMS {
  source string
  campaign string
}

WEBHOOKS {
  delivery string
  click string
  conversion string
}

CEPSTRATEGY {
  channel_priority string[]
  optimal_time string
}

CDPDATA {
  user_id string
  profile Profile
}

PROFILE {
  loyalty_tier string
  last_purchase string
}

NOTIFICATION ||--|| NOTIFICATIONDATA : has
NOTIFICATIONDATA ||--|| VARIABLES : contains
NOTIFICATION ||--|| TARGETINGRULES : has
NOTIFICATION ||--|| NOTIFICATIONACTION : has
NOTIFICATION ||--|| NOTIFICATIONSCHEDULE : has
NOTIFICATIONSCHEDULE ||--|| TRIGGERCONDITIONS : contains
NOTIFICATION ||--|| TRACKINGSETTINGS : has
TRACKINGSETTINGS ||--|| UTMPARAMS : contains
NOTIFICATION ||--|| WEBHOOKS : has
NOTIFICATION ||--|| CEPSTRATEGY : has
NOTIFICATION ||--|| CDPDATA : has
CDPDATA ||--|| PROFILE : contains
